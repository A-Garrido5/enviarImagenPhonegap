<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8" />

        
        <script src="jquery.mobile/jquery-1.7.2.min.js"></script>

        
        <script type="text/javascript" charset="utf-8" src="js/json2.js"></script>
        
    
                  
            <!--<script src="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.js"></script> -->
        <script type="text/javascript" charset="utf-8" src="jquery.mobile/jquery.mobile-1.4.5.js"></script>
        
            
        
    <title>PhoneGap</title>


    </head>

    <body>
        
       <script type="text/javascript"> 

       //var keyName = window.localStorage.key("open");

       var value = window.localStorage.getItem("username");


       //window.localStorage.removeItem("open");


       alert(value);

       function isNumber(e) {
          k = (document.all) ? e.keyCode : e.which;
          if (k==8 || k==0) return true;
          patron = /\w/ ;
          n = String.fromCharCode(k);
          return patron.test(n);
       }

       $('#botonLogin').click(function() { 

            var datosUsuario = $("#nombredeusuario").val()
            var datosPassword = $("#clave").val()

            var cripto = window.btoa(datosUsuario+'|'+datosPassword);

        
            //var urlLogin="http://services.macroinside.com/ServicioRTC.svc/ValidarUsuario/"+cripto; 

            var urlLogin="http://sae1.imatronix.com:2614/WEBAPI_SERVICE/api/Login/"+cripto; 

            localStorage.setItem('user', cripto);
            valor = localStorage.getItem('user');

            $.ajax({

                  url: urlLogin,
                  type: "GET",
                  dataType: "json",

                  success: function(json) {

                    alert(JSON.stringify(json));

                    var sesionvalida = parseInt(json.sesionValida);

                    if(sesionvalida!=1){
                      alert(json.mensaje);
                                          }

                    else{
                      alert("            "+json.mensaje +'\n'+json.nombres);
                      localStorage.setItem("username", json.nombres);
                      

                    }
                                    
                    //document.getElementById('nombres').innerHTML=json.nombres.toString();
                    

                    //alert(json.nombres);
                       

                       
              
                    



                  },

                  error:function (xhr, ajaxOptions, thrownError) {
                     alert(JSON.stringify(thrownError));
                     alert(JSON.stringify(xhr));
                  }

            });


       });

        var permanentStorage = window.localStorage;


       </script>
         
        
        <br>
        <br>
        <br>
        <label> Usuario </label><br>
        <input type="text" id="nombredeusuario" value="demo" name="nombredeusuario" placeholder="Ingrese su nombre de usuario" onKeyDown="return isNumber(event);" onpaste="return false" >
        <br>
        <br>
        <label> Password </label><br>
        <input type="password" id="clave" name="clave" value="password" placeholder="Ingrese su contrase&ntilde;a" onpaste="return false" onKeyDown="return isNumber(event);">
        <br>
        <button type="submit" id="botonLogin">Enviar</button> 

        <div class="center" id="nombres"></div>
      
        
    
        
    </body>
</html>
